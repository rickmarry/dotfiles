"use strict";var Front=function(){function e(){g.remove("sk_scroller_indicator_top"),g.remove("sk_scroller_indicator_middle"),g.remove("sk_scroller_indicator_bottom")}function t(e,t){s.enter(0,!0),b&&"none"!==b.style.display&&(b.style.display="none",b.onHide&&b.onHide()),b=e,b.style.display="",b.onShow&&b.onShow(t),s.flush()}function n(e,t){var n=["Help","Mouse Click","Scroll Page / Element","Tabs","Page Navigation","Sessions","Search selected with","Clipboard","Omnibar","Visual Mode","vim-like marks","Settings","Chrome URLs","Proxy","Misc","Insert Mode"];initL10n(function(o){var i=n.map(function(){return[]});i[0].push("<div><span class=kbd-span><kbd>&lt;Alt-s&gt;</kbd></span><span class=annotation>{0}</span></div>".format(o("Toggle SurfingKeys on current site"))),e=e.concat(getAnnotations(Omnibar.mappings)),e.forEach(function(e){var t=KeyboardUtils.decodeKeystroke(e.word),n="<div><span class=kbd-span><kbd>"+htmlEncode(t)+"</kbd></span><span class=annotation>"+o(e.annotation)+"</span></div>";i[e.feature_group].push(n)}),i=i.map(function(e,t){return e.length?"<div><div class=feature_name><span>{0}</span></div>{1}</div>".format(o(n[t]),e.join("")):""}).join(""),i+="<p style='float:right; width:100%; text-align:right'><a href='https://github.com/brookhong/surfingkeys' target='_blank' style='color:#0095dd'>"+o("More help")+"</a></p>",t(i)})}function o(){k&&(clearTimeout(k),k=void 0)}function i(e){initL10n(function(t){var n=e.accumulated,o=e.candidates;if(n=Object.keys(o).sort().map(function(n){var i=o[n];return i.annotation?"<div><span class=kbd-span><kbd>"+htmlEncode(KeyboardUtils.decodeKeystroke(e.accumulated))+"<span class=candidates>"+n.substr(e.accumulated.length)+"</span></kbd></span><span class=annotation>"+t(i.annotation)+"</span></div>":""}).join(""),n.length>0&&k){setInnerHTML(v,n);var i=v.classList;i.remove("expandRichHints"),i.remove("simpleHint"),i.add("expandRichHints"),s.flush()}})}var s=new Mode("Front");s.isProvider=function(){return!0};var a,r={},d={};s.contentCommand=function(e,t){e.commandToContent=!0,e.id=generateQuickGuid(),t&&(e.ack=!0,d[e.id]=t),top.postMessage(e,a)},s.addEventListener("keydown",function(e){Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(s.hidePopup(),e.sk_stopPropagation=!0):p.trie&&(p.trie=p.trie.find(e.sk_keyName),p.trie?p.trie.meta&&(RUNTIME("focusTab",{tab_id:p.trie.meta.id,window_id:p.trie.meta.windowId}),s.hidePopup(),p.trie=null):(s.hidePopup(),p.trie=null),e.sk_stopPropagation=!0)}),s.flush=function(){var e=Array.from(document.body.querySelectorAll("body>div")).filter(function(e){return"none"!==e.style.display}),t=e.map(function(e){var t=e.id,n=["sk_keystroke","sk_banner"];return n.indexOf(t)===-1&&("sk_status"===t?null!==s.statusBar.querySelector("input"):!e.noPointerEvents)});if(t.push(!1),t=t.reduce(function(e,t){return e||t}))if(window.focus(),e[0]===s.omnibar)s.omnibar.querySelector("input").focus();else if(e[0]===u){var n=u.querySelector("div.ace_dialog-bottom>input")||u.querySelector("textarea");n&&n.focus()}else e[0].focus();top.postMessage({action:"setFrontFrame",pointerEvents:t?"all":"none",frameHeight:e.length>0?"100%":"0px"},a)},s.visualCommand=function(e){"none"!==l.style.display?Visual[e.action](e.query):s.contentCommand(e)},s.omnibar=document.getElementById("sk_omnibar"),s.statusBar=document.getElementById("sk_status");var l=document.getElementById("sk_usage"),c=document.getElementById("sk_popup"),u=document.getElementById("sk_editor"),p=document.getElementById("sk_tabs"),h=document.getElementById("sk_banner"),m=document.getElementById("sk_bubble"),f=m.querySelector("div.sk_bubble_content"),y=m.querySelector("div.sk_arrow"),g=f.classList;f.onscroll=function(t){e(),0===this.scrollTop?g.add("sk_scroller_indicator_top"):this.scrollTop+this.offsetHeight>=this.scrollHeight?g.add("sk_scroller_indicator_bottom"):g.add("sk_scroller_indicator_middle")};var b,v=document.getElementById("sk_keystroke");r.hidePopup=function(){b&&"none"!==b.style.display&&(b.style.display="none",s.flush(),b.onHide&&b.onHide(),s.exit())},s.hidePopup=r.hidePopup,p.onShow=function(e){setInnerHTML(p,""),p.trie=new Trie;var t=Hints.genLabels(e.length),n="<div class=sk_tab style='width: 200px'>";e.forEach(function(e,o){var i=createElement(n);p.trie.add(t[o].toLowerCase(),e),setInnerHTML(i,"<div class=sk_tab_hint>"+t[o]+"</div><div class=sk_tab_wrap><div class=sk_tab_icon><img src='chrome://favicon/"+e.url+"'></div><div class=sk_tab_title>"+htmlEncode(e.title)+"</div></div>"),i.url=e.url,p.append(i)}),p.querySelectorAll("div.sk_tab").forEach(function(e){e.append(createElement("<div class=sk_tab_url>"+e.url+"</div>"))})},r.chooseTab=function(){runtime.command({action:"getTabs"},function(e){e.tabs.length>runtime.conf.tabsThreshold?t(s.omnibar,{type:"Tabs"}):e.tabs.length>0&&t(p,e.tabs)})},l.onShow=function(e){n(e.metas,function(e){setInnerHTML(l,e)})},r.showUsage=function(e){t(l,e)},r.applyUserSettings=function(e){for(var t in e.userSettings)runtime.conf.hasOwnProperty(t)&&(runtime.conf[t]=e.userSettings[t]);"theme"in e.userSettings&&setInnerHTML(document.getElementById("sk_theme"),e.userSettings.theme)},r.executeCommand=function(e){Commands.execute(e.cmdline)},r.addCMap=function(e){_map(Omnibar,e.new_keystroke,e.old_keystroke)},r.addVimMap=function(e){s.vimMappings.push([e.lhs,e.rhs,e.ctx])},r.addVimKeyMap=function(e){s.vimKeyMap=e.vimKeyMap},r.addSearchAlias=function(e){SearchEngine.aliases[e.alias]={prompt:""+e.prompt+separatorHtml,url:e.url,suggestionURL:e.suggestionURL}},r.removeSearchAlias=function(e){delete SearchEngine.aliases[e.alias]},r.getUsage=function(e){delete e.ack,n(e.metas,function(t){top.postMessage({data:t,action:e.action+"Ack",responseToContent:e.commandToFrontend,id:e.id},a)})},s.showUsage=s.hidePopup,r.showPopup=function(e){s.showPopup(e.content)},s.showPopup=function(e){setInnerHTML(c,e),t(c)},s.vimMappings=[],u.onShow=function(e){"undefined"!=typeof AceEditor?AceEditor.show(e):Normal.insertJS("../libs/ace/ace.js",function(){ace.config.set("workerPath","../libs/ace"),ace.config.set("modePath","../libs/ace"),ace.config.set("themePath","../libs/ace"),ace.config.set("basePath","../libs/ace"),Normal.insertJS("editor.js",function(){AceEditor.show(e)})})},r.showEditor=function(e){e.onEditorSaved&&(s.onEditorSaved=e.onEditorSaved),t(u,e)},s.showEditor=r.showEditor,r.updateOmnibarResult=function(e){Omnibar.listWords(e.words)},r.openOmnibar=function(e){t(s.omnibar,e);var n=e.style||"";setInnerHTML(s.omnibar.querySelector("style"),"#sk_omnibar {"+n+"}")},s.openOmnibar=r.openOmnibar,r.openFinder=function(){Find.open()},s.openFinder=r.openFinder,s.showBanner=function(e,t){h.classList.remove("slideInBanner"),h.style.display="",setInnerHTML(h,htmlEncode(e)),s.flush(),h.classList.add("slideInBanner"),h.one("animationend",function(){h.classList.remove("slideInBanner"),h.style.display="none",s.flush()})},r.showBanner=function(e){s.showBanner(e.content,e.linger_time)},r.showBubble=function(t){var n=t.position;n.left+=n.winX,n.top+=n.winY,m.style.top="0px",m.style.left="0px",setInnerHTML(f,t.content),f.style.maxWidth=n.winWidth-32+"px",f.scrollTop=0,e(),m.style.display="";var o=m.offsetWidth,i=m.offsetHeight,a=[n.left-11-o/2,o/2];a[0]<n.winX?(a[1]+=a[0]-n.winX,a[0]=n.winX):a[0]+o>n.winWidth&&(a[1]+=a[0]-n.winX-n.winWidth+o,a[0]=n.winX+n.winWidth-o),y.style.left=a[1]+n.width/2-2+"px",m.style.left=a[0]+"px",m.noPointerEvents=t.noPointerEvents,n.top+n.height/2>n.winHeight/2?(y.setAttribute("dir","down"),y.style.top="100%",f.style.maxHeight=n.top-12-32+"px",i=m.offsetHeight,m.style.top=n.top-i-12+"px"):(y.setAttribute("dir","up"),y.style.top="-12px",f.style.maxHeight=n.winHeight-(n.top+n.height+12)-32+"px",i=m.offsetHeight,m.style.top=n.top+n.height+12+"px"),f.scrollHeight>f.offsetHeight&&(m.noPointerEvents=!1,g.add("sk_scroller_indicator_top")),s.flush(),m.noPointerEvents||(b=m,s.onShowBubble&&s.onShowBubble(m),s.enter(0,!0))},s.showBubble=function(){},r.hideBubble=function(){m.style.display="none",s.flush()},s.hideBubble=r.hideBubble,r.visualUpdatedForFirefox=function(e){s.statusBar.querySelector("input").focus()},r.showStatus=function(e){Mode.stack()[0]!==Find&&s.showStatus(e.position,e.content,e.duration)},s.showStatus=function(e,t,n){StatusBar.show(e,t,n)},s.toggleStatus=function(e){e?s.statusBar.style.display="":s.statusBar.style.display="none"},r.toggleStatus=function(e){s.toggleStatus(e.visible)};var k;return r.hideKeystroke=function(){if("none"!==v.style.display){var e=v.classList.contains("expandRichHints")?"collapseRichHints":"slideOutRight";v.classList.remove("expandRichHints"),v.classList.add(e),v.one("animationend",function(){setInnerHTML(v,""),v.style.display="none",s.flush()})}runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&o()},s.hideKeystroke=r.hideKeystroke,Visual.mappings.add("y",{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9}),r.showKeystroke=function(e){if("none"!==v.style.display&&v.classList.contains("expandRichHints"))i(e.keyHints);else{o(),v.style.display="",s.flush();var t=v.innerHTML+htmlEncode(KeyboardUtils.decodeKeystroke(e.keyHints.key));setInnerHTML(v,t);var n=v.classList;n.remove("slideInRight"),n.remove("slideOutRight"),n.remove("collapseRichHints"),n.add("slideInRight"),n.add("simpleHint"),runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&(k=setTimeout(function(){i(e.keyHints)},runtime.conf.richHintsForKeystroke))}},s.showKeystroke=function(){},r.initFrontend=function(e){return a=e.origin,(new Date).getTime()},window.addEventListener("message",function(e){var t=e.data;if(d[t.id]){var n=d[t.id];n(t)||delete d[t.id]}else if(t.action&&r.hasOwnProperty(t.action)){var o=r[t.action](t);t.ack&&top.postMessage({data:o,action:t.action+"Ack",responseToContent:t.commandToFrontend,id:t.id},a)}},!0),s}();