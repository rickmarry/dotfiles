"use strict";function _regexFromString(str,highlight){var rxp=null;if(/^\/.+\/([gimuy]*)$/.test(str))try{rxp=eval(str)}catch(e){rxp=null}if(!rxp&&(/^\/.+$/.test(str)&&(rxp=eval(str+"/i")),!rxp))if(str=str.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),highlight)rxp=new RegExp(str.replace(/\s+/,"|"),"gi");else{var words=str.split(/\s+/).map(function(e){return"(?=.*"+e+")"}).join("");rxp=new RegExp("^"+words+".*$","gi")}return rxp}function _filterByTitleOrUrl(e,n){if(n&&n.length){var t=_regexFromString(n,!1);e=e.filter(function(e){return t.test(e.title)||t.test(e.url)})}return e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},separator="‚û§",separatorHtml="<span class='separator'>"+separator+"</span>",Omnibar=function(){function e(e){var n=Array.from(o.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),t=n.length;if(t>0){var r=o.resultsDiv.querySelector("li.focused");r&&r.classList.remove("focused");var i=n.indexOf(r);i=i===-1?t:i;var s=(e?i+t:i+t+2)%(t+1);s<t?(Omnibar.focusItem(n[s]),a.onTabKey&&a.onTabKey()):o.input.value=u}}function n(){u!==o.input.value&&(u=o.input.value),a.onInput&&a.onInput.call(this)}function t(e){a&&a.onKeydown&&a.onKeydown.call(e.target,e)&&e.preventDefault(),Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(Front.hidePopup(),e.preventDefault()):e.keyCode===KeyboardUtils.keyCodes.enter?(a.activeTab=!e.ctrlKey,a.tabbed=Omnibar.tabbed^e.shiftKey,a.onEnter()&&Front.hidePopup()):e.keyCode===KeyboardUtils.keyCodes.space?o.expandAlias(o.input.value,"")&&e.preventDefault():e.keyCode===KeyboardUtils.keyCodes.backspace&&o.collapseAlias()&&e.preventDefault()}function r(){var e=(d-1)*b,n=e+b;n=n>p.length?p.length:n,setInnerHTML(m,e+1+" - "+n+" / "+p.length),v=p.slice(e,n);var t=o.input.value.trim(),r=null;t.length&&(r=_regexFromString(t,!0)),o.listResults(v,function(e){var n;if(e.hasOwnProperty("html"))n=o.createItemFromRawHtml(e);else if(e.hasOwnProperty("url")&&void 0!==e.url){if(window.navigator.userAgent.indexOf("Firefox")!==-1&&/^(place|data):/i.test(e.url))return null;n=o.createURLItem(e,r)}else f&&(n=createElement('<li><div class="title">‚ñ∑ '+o.highlight(r,e.title)+"</div></li>"),n.folder_name=e.title,n.folderId=e.id);return n})}var o=new Mode("Omnibar");o.addEventListener("keydown",function(e){e.sk_keyName.length&&Mode.handleMapKey.call(o,e),e.sk_suppressed=!0}).addEventListener("mousedown",function(e){e.sk_suppressed=!0}),o.mappings=new Trie,o.map_node=o.mappings,o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-d>"),{annotation:"Delete focused item from bookmark or history",feature_group:8,code:function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.uid&&runtime.command({action:"removeURL",uid:e.uid},function(n){"Done"===n.response&&e.remove()})}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-i>"),{annotation:"Edit selected URL with vim editor, then open",feature_group:8,code:function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.url&&Front.showEditor({initial_line:1,type:"url",content:e.url,onEditorSaved:function(e){e&&tabOpenLink(e)}})}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-j>"),{annotation:"Toggle Omnibar's position",feature_group:8,code:function(){"bottom"===runtime.conf.omnibarPosition?runtime.conf.omnibarPosition="middle":runtime.conf.omnibarPosition="bottom",setTimeout(function(){g.pref=o.input.value,Front.hidePopup(),Front.openOmnibar(g)},1)}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-.>"),{annotation:"Show results of next page",feature_group:8,code:function(){p&&(d*b<p.length?d++:d=1,r())}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-,>"),{annotation:"Show results of previous page",feature_group:8,code:function(){p&&(d>1?d--:d=Math.ceil(p.length/b),r())}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-c>"),{annotation:"Copy all listed items",feature_group:8,code:function(){o.input.style.display="none",Clipboard.write(JSON.stringify(v,null,4)),o.input.style.display=""}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-D>"),{annotation:"Delete all listed items from bookmark or history",feature_group:8,code:function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")).map(function(e){return e.uid}).filter(function(e){return e});e.length&&runtime.command({action:"removeURL",uid:e},function(e){"Done"===e.response&&(a&&a.getResults&&a.getResults(),Omnibar.triggerInput())})}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-r>"),{annotation:"Re-sort history by visitCount or lastVisitTime",feature_group:8,code:function(){a&&a.onReset&&a.onReset()}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Esc>"),{annotation:"Close Omnibar",feature_group:8,code:function(){Front.hidePopup()}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-m>"),{annotation:"Create vim-like mark for selected item",feature_group:8,code:function(e){var n=Omnibar.resultsDiv.querySelector("li.focused");n&&Normal.addVIMark(e,n.url)}});var i,a,s={},u="",l=null,c=Front.omnibar;c.onclick=function(e){a.onClick?a.onClick(e):o.input.focus()},o.triggerInput=function(){var e=new Event("input",{bubbles:!0,cancelable:!0});o.input.dispatchEvent(e)},o.expandAlias=function(e,n){var t=!1;return a!==SearchEngine&&e.length&&SearchEngine.aliases.hasOwnProperty(e)&&(l=a,a=SearchEngine,Object.assign(SearchEngine,SearchEngine.aliases[e]),setInnerHTML(o.resultsDiv,""),setInnerHTML(o.promptSpan,a.prompt),setInnerHTML(m,""),p=null,o.collapsingPoint=n,o.input.value=n,n.length&&Omnibar.triggerInput(),t=!0),t},o.collapseAlias=function(){var e=!1,n=o.input.value;return!l||a===l||n!==o.collapsingPoint&&""!==n||(a=l,l=null,setInnerHTML(o.promptSpan,a.prompt),n.length&&(o.input.value=n.substr(0,n.length-1)),Omnibar.triggerInput(),e=!0),e},o.focusItem=function(e){"string"==typeof e&&(e=o.resultsDiv.querySelector(e)),e.classList.add("focused"),scrollIntoViewIfNeeded(e)},o.input=c.querySelector("input"),o.promptSpan=c.querySelector("#sk_omnibarSearchArea>span.prompt");var m=c.querySelector("#sk_omnibarSearchArea>span.resultPage");o.resultsDiv=c.querySelector("#sk_omnibarSearchResult"),o.input.oninput=n,o.input.onkeydown=t,o.input.addEventListener("compositionstart",function(e){o.input.oninput=null,o.input.onkeydown=null}),o.input.addEventListener("compositionend",function(e){o.input.oninput=n,o.input.onkeydown=t,n()}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Tab>"),{annotation:"Forward cycle through the candidates.",feature_group:8,code:function(){e("bottom"===runtime.conf.omnibarPosition)}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Shift-Tab>"),{annotation:"Backward cycle through the candidates.",feature_group:8,code:function(){e("bottom"!==runtime.conf.omnibarPosition)}}),o.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-'>"),{annotation:"Toggle quotes in an input element",feature_group:8,code:toggleQuote}),o.highlight=function(e,n){return"data:image/"===n.substr(0,11)&&(n=n.substr(0,1024)),null===e?n:n.replace(e,function(e){return"<span class=omnibar_highlight>"+e+"</span>"})},o.createURLItem=function(e,n){e.title=e.title&&""!==e.title?e.title:e.url;var t=e.type,r="",a=e.uid;t||(e.hasOwnProperty("lastVisitTime")?(t="üïú",r="<span class=omnibar_timestamp># "+timeStampString(e.lastVisitTime)+"</span>",r+="<span class=omnibar_visitcount> ("+e.visitCount+")</span>",a="H"+e.url):e.hasOwnProperty("dateAdded")?(t="‚≠ê",r="<span class=omnibar_folder>@ "+(i[e.parentId].title||"")+"</span> <span class=omnibar_timestamp># "+timeStampString(e.dateAdded)+"</span>",a="B"+e.id):e.hasOwnProperty("width")?(t="üîñ",a="T"+e.windowId+":"+e.id):t="üî•");var s=createElement('<li><div class="title">'+t+" "+o.highlight(n,htmlEncode(e.title))+" "+r+'</div><div class="url">'+o.highlight(n,e.url)+"</div></li>");return s.uid=a,s.url=e.url,s},o.createItemFromRawHtml=function(e){var n=e.html,t=e.props,r=createElement(n);return"object"===("undefined"==typeof t?"undefined":_typeof(t))&&Object.assign(r,t),r},o.detectAndInsertURLItem=function(e,n){var t=/^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n\s]+)\.([^:\/\n\s]+)/i,r=/^https?:\/\/(?:[^@\/\n]+@)?([^:\/\n\s]+)/i;if(t.test(e)){var o=e;/^https?:\/\//.test(e)||(o="http://"+e),n.unshift({title:e,url:o})}else r.test(e)&&n.unshift({title:e,url:e})};var d,p,f,b,v;o.listURLs=function(e,n){b=runtime.conf.omnibarMaxResults||10,d=1,p=e,f=n,r()};var g;return c.onShow=function(e){g=e,c.classList.remove("sk_omnibar_middle"),c.classList.remove("sk_omnibar_bottom"),c.classList.add("sk_omnibar_"+runtime.conf.omnibarPosition),"bottom"===runtime.conf.omnibarPosition?(o.resultsDiv.remove(),c.insertBefore(o.resultsDiv,document.querySelector("#sk_omnibarSearchArea"))):(o.resultsDiv.remove(),c.append(o.resultsDiv)),o.tabbed=void 0===e.tabbed||e.tabbed,a=s[e.type],o.input.focus(),o.enter(),e.pref&&(o.input.value=e.pref),a.onOpen&&a.onOpen(e.extra),l=a,a=a,setInnerHTML(o.promptSpan,a.prompt),setInnerHTML(m,""),c.scrollTop=0},c.onHide=function(){delete o.cachedPromise,p=null,i=null,u="",o.input.value="",setInnerHTML(o.resultsDiv,""),l=null,a.onClose&&a.onClose(),o.exit(),a=null},o.openFocused=function(){var e,n=o.resultsDiv.querySelector("li.focused");if(n?e=n.url:(e=o.input.value,e.indexOf(":")===-1&&(e=SearchEngine.aliases[runtime.conf.defaultSearchEngine].url+e)),/^javascript:/.test(e)){var t=e.replace(/^javascript:/,"");runtime.command({action:"executeScript",code:t},function(e){})}else{var r,i="";n&&n.uid&&(r=n.uid,i=r[0],r=r.substr(1)),"T"===i?(r=r.split(":"),runtime.command({action:"focusTab",window_id:parseInt(r[0]),tab_id:parseInt(r[1])})):e&&e.length&&runtime.command({action:"openLink",tab:{tabbed:this.tabbed,active:this.activeTab},url:e})}return this.activeTab},o.listResults=function(e,n){if(setInnerHTML(o.resultsDiv,""),e&&0!==e.length){"bottom"===runtime.conf.omnibarPosition&&e.reverse();var t=createElement("<ul/>");if(e.forEach(function(e){var r=n(e);r&&t.append(r)}),o.resultsDiv.append(t),e=o.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li"),runtime.conf.focusFirstCandidate){var r="bottom"===runtime.conf.omnibarPosition?e.length-1:0;e[r].classList.add("focused")}"bottom"===runtime.conf.omnibarPosition&&e.length>0&&scrollIntoViewIfNeeded(e[e.length-1])}},o.listWords=function(e){o.listResults(e,function(e){var n=createElement("<li>‚åï "+e+"</li>");return n.query=e,n})},o.html=function(e){setInnerHTML(o.resultsDiv,e)},o.addHandler=function(e,n){s[e]=n},o.listBookmarkFolders=function(e){runtime.command({action:"getBookmarkFolders"},function(n){i={},n.folders.forEach(function(e){i[e.id]=e}),e&&e(n,i)})},o}(),OpenBookmarks=function(){function e(){var e=t.inFolder.pop();e.folderId?(n=e.folderId,runtime.command({action:"getBookmarks",parentId:n},t.onResponse)):(n=void 0,runtime.command({action:"getBookmarks"},t.onResponse)),t.prompt=e.prompt,setInnerHTML(Omnibar.promptSpan,t.prompt),o=e.focused}var n,t={prompt:"bookmark"+separatorHtml,inFolder:[]},r=!1,o=0;return t.onEnter=function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),r=!1,i=Omnibar.resultsDiv.querySelector("li.focused"),a=i.folderId;return a?(t.inFolder.push({prompt:t.prompt,folderId:n,focused:e.indexOf(i)}),t.prompt=i.folder_name+separator,setInnerHTML(Omnibar.promptSpan,t.prompt),Omnibar.input.value="",n=a,o=0,runtime.command({action:"getBookmarks",parentId:n},OpenBookmarks.onResponse)):(r=Omnibar.openFocused.call(t),r&&(t.inFolder.push({prompt:t.prompt,folderId:n,focused:e.indexOf(i)}),localStorage.setItem("surfingkeys.lastOpenBookmark",JSON.stringify(t.inFolder)))),r},t.onOpen=function(){Omnibar.listBookmarkFolders(function(){var n=localStorage.getItem("surfingkeys.lastOpenBookmark");n?(t.inFolder=JSON.parse(n),e()):runtime.command({action:"getBookmarks"},t.onResponse),""!==Omnibar.input.value&&t.onInput()})},t.onClose=function(){t.inFolder=[],t.prompt="bookmark"+separatorHtml,n=void 0},t.onKeydown=function(o){var i=!1;if(o.keyCode===KeyboardUtils.keyCodes.comma)r=!r,t.prompt=r?"bookmark folder"+separator:"bookmark"+separator,setInnerHTML(Omnibar.promptSpan,t.prompt),runtime.command({action:"getBookmarks",parentId:n,query:Omnibar.input.value},t.onResponse),i=!0;else if(o.keyCode===KeyboardUtils.keyCodes.backspace&&t.inFolder.length&&!Omnibar.input.value.length)e(),i=!0;else if(o.ctrlKey&&o.shiftKey&&KeyboardUtils.isWordChar(o)){var a=Omnibar.resultsDiv.querySelector("li.focused");if(a){var s=String.fromCharCode(o.keyCode);Normal.addVIMark(s,a.url),i=!0}}return i},t.onInput=function(){runtime.command({action:"getBookmarks",parentId:n,query:Omnibar.input.value},t.onResponse)},t.onResponse=function(e){var n=e.bookmarks;r&&(n=n.filter(function(e){return!e.hasOwnProperty("url")||void 0===e.url})),Omnibar.listURLs(n,!0);var n=Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li");Omnibar.focusItem(n[o])},t}();Omnibar.addHandler("Bookmarks",OpenBookmarks);var AddBookmark=function(){var e,n,t={prompt:"add bookmark"+separatorHtml};return t.onOpen=function(r){t.page=r,n=runtime.conf.focusFirstCandidate,runtime.conf.focusFirstCandidate=!0,Omnibar.listBookmarkFolders(function(n){e=n.folders,Omnibar.listResults(e.slice(),function(e){return createElement('<li folder="'+e.id+'">‚ñ∑ '+e.title+"</li>")}),runtime.command({action:"getBookmark"},function(e){if(e.bookmarks.length){var n=e.bookmarks[0];setInnerHTML(Omnibar.promptSpan,"edit bookmark"+separatorHtml),Omnibar.resultsDiv.querySelector("li.focused").classList.remove("focused"),Omnibar.focusItem('li[folder="'+n.parentId+'"]')}var r=localStorage.getItem("surfingkeys.lastAddedBookmark");r&&(Omnibar.input.value=r,Omnibar.input.select(),t.onInput())})})},t.onClose=function(){runtime.conf.focusFirstCandidate=n},t.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");Omnibar.input.value=e.innerHTML.substr(2)},t.onEnter=function(){t.page.path=[];var n,r=Omnibar.resultsDiv.querySelector("li.focused");if(r)t.page.folder=r.getAttribute("folder"),n=r.innerHTML.substr(2);else{var o=Omnibar.input.value;o=o.split("/");var i=o.pop();i.length&&(t.page.title=i),o=o.filter(function(e){return e.length>0});for(var a=o.length;a>0;a--){var s=e.filter(function(e){return e.title==="/"+o.slice(0,a).join("/")+"/"});if(s.length){t.page.folder=s[0].id,t.page.path=o.slice(a),n="/"+o.join("/");break}}void 0===t.page.folder&&(t.page.folder=e[0].id,t.page.path=o,n=""+e[0].title+o.join("/"))}return runtime.command({action:"createBookmark",page:t.page},function(e){Front.showBanner("Bookmark created at {0}.".format(n),3e3)}),localStorage.setItem("surfingkeys.lastAddedBookmark",Omnibar.input.value),!0},t.onInput=function(){var n=Omnibar.input.value,t=runtime.getCaseSensitive(n),r=e.filter(function(e){return t?e.title.indexOf(n)!==-1:e.title.toLowerCase().indexOf(n.toLowerCase())!==-1});Omnibar.listResults(r,function(e){return createElement('<li folder="'+e.id+'">‚ñ∑ '+e.title+"</li>")})},t}();Omnibar.addHandler("AddBookmark",AddBookmark);var OpenHistory=function(){var e={prompt:"history"+separatorHtml};return e.onOpen=function(n){e.getResults(),e.onInput()},e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,n){runtime.command({action:"getHistory",sortByMostUsed:runtime.conf.historyMUOrder},function(n){e(n.history)})})},e.onReset=function(){runtime.conf.historyMUOrder=!runtime.conf.historyMUOrder,Omnibar.cachedPromise.then(function(e){e=runtime.conf.historyMUOrder?e.sort(function(e,n){return n.visitCount-e.visitCount}):e.sort(function(e,n){return n.lastVisitTime-e.lastVisitTime});var n=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(n,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var n=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(n,!1)})},e}();Omnibar.addHandler("History",OpenHistory);var OpenURLs=function(){var e={prompt:""+separatorHtml};return e.getResults=function(){"getAllSites"===e.action?Omnibar.cachedPromise=new Promise(function(e,n){runtime.command({action:"getTabs",queryInfo:runtime.conf.omnibarTabsQuery},function(n){var t=n.tabs;runtime.command({action:"getTopSites"},function(n){t=t.concat(n.urls),Omnibar.listBookmarkFolders(function(){runtime.command({action:"getAllURLs"},function(n){t=t.concat(n.urls),e(t)})})})})}):Omnibar.cachedPromise=new Promise(function(n,t){runtime.command({action:e.action},function(e){n(e.urls)})})},e.onOpen=function(n){e.action=n,"getRecentlyClosed"===e.action?e.prompt="Recently closed"+separatorHtml:"getTabURLs"===e.action?e.prompt="Tab History"+separatorHtml:e.prompt=""+separatorHtml,e.getResults(),e.onInput()},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var n=Omnibar.input.value,t=_filterByTitleOrUrl(e,n);0===t.length?Omnibar.expandAlias(runtime.conf.defaultSearchEngine,n):(Omnibar.detectAndInsertURLItem(n,t),Omnibar.listURLs(t,!1))})},e}();Omnibar.addHandler("URLs",OpenURLs);var OpenTabs=function(){var e={prompt:"tabs"+separatorHtml};return e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,n){runtime.command({action:"getTabs",query:""},function(n){e(n.tabs)})})},e.onEnter=Omnibar.openFocused.bind(e),e.onOpen=function(){e.getResults(),e.onInput()},e.onInput=function(){Omnibar.cachedPromise.then(function(e){var n=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(n,!1)})},e}();Omnibar.addHandler("Tabs",OpenTabs);var OpenVIMarks=function(){var e={prompt:"VIMarks"+separatorHtml};return e.onOpen=function(){var e=Omnibar.input.value,n=[];runtime.command({action:"getSettings",key:"marks"},function(t){for(var r in t.settings.marks){var o=t.settings.marks[r];"string"==typeof o&&(o={url:o,scrollLeft:0,scrollTop:0}),""!==e&&o.url.indexOf(e)===-1||n.push({title:r,type:"‚ô°",uid:"M"+r,url:o.url})}Omnibar.listURLs(n,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=e.onOpen,e}();Omnibar.addHandler("VIMarks",OpenVIMarks);var SearchEngine=function(){function e(){r&&(clearTimeout(r),r=void 0)}function n(e,n){return e.indexOf("%s")!==-1?e.replace("%s",n):e+n}var t={};t.aliases={};var r=void 0;return t.onOpen=function(e){Object.assign(t,t.aliases[e]);var n=Omnibar.input.value;if(n.length){var r=n.match(/^(site:\S+\s*).*/);r&&Omnibar.input.setSelectionRange(r[1].length,n.length),Omnibar.triggerInput()}},t.onClose=function(){e(),t.prompt=void 0,t.url=void 0,t.suggestionURL=void 0},t.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.query&&(Omnibar.input.value=e.query)},t.onEnter=function(){var e,n=Omnibar.resultsDiv.querySelector("li.focused");return e=n?n.url||constructSearchURL(t.url,n.query||encodeURIComponent(Omnibar.input.value)):constructSearchURL(t.url,encodeURIComponent(Omnibar.input.value)),runtime.command({action:"openLink",tab:{tabbed:this.tabbed,active:this.activeTab},url:e}),this.activeTab},t.onInput=function(){var o=t.suggestionURL,i=o&&runtime.conf.omnibarSuggestion;if(!i)return!1;var a=encodeURIComponent(Omnibar.input.value);e(),r=setTimeout(function(){runtime.command({action:"request",method:"get",url:n(t.suggestionURL,a)},function(e){Front.contentCommand({action:"getSearchSuggestions",url:t.suggestionURL,response:e},function(e){if(e=e.data,Array.isArray(e)){Omnibar.detectAndInsertURLItem(Omnibar.input.value,e);var n=_regexFromString(a,!0);Omnibar.listResults(e,function(e){if(e.hasOwnProperty("html"))return Omnibar.createItemFromRawHtml(e);if(e.hasOwnProperty("url"))return Omnibar.createURLItem(e,n);var t=createElement("<li>‚åï "+e+"</li>");return t.query=e,t})}})})},runtime.conf.omnibarSuggestionTimeout)},t}();Omnibar.addHandler("SearchEngine",SearchEngine);var Commands=function(){function e(e){for(var e=e.trim(),n=[],t=!1,r="",o=0;o<e.length;o++)" "!==e.charAt(o)||t?'"'===e.charAt(o)?t=!t:r+=e.charAt(o):(n.push(r),r="");return n.push(r),n}var n={prompt:":",items:{}},t=0;return n.onOpen=function(){t=-1,runtime.command({action:"getSettings",key:"cmdHistory"},function(e){var n=e.settings.cmdHistory;n.length&&Omnibar.listResults(n,function(e){var n=createElement("<li>"+e+"</li>");return n.cmd=e,n})})},n.onReset=n.onOpen,n.onInput=function(){var e=Omnibar.input.value,t=Object.keys(n.items).filter(function(n){return""===e||n.indexOf(e)!==-1});t.length&&Omnibar.listResults(t,function(e){var t=createElement("<li>"+e+"<span class=annotation>"+htmlEncode(n.items[e].annotation)+"</span></li>");return t.cmd=e,t})},n.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").cmd},n.onEnter=function(){var e=!1,t=Omnibar.input.value;return t.length&&(runtime.updateHistory("cmd",t),n.execute(t),Omnibar.input.value=""),e},n.execute=function(t){var r=e(t),o=r.shift();if(n.items.hasOwnProperty(o)){var i=n.items[o];i.code.call(i.code,r)}else Front.contentCommand({action:"executeScript",cmdline:t})},n}();Omnibar.addHandler("Commands",Commands);var OmniQuery=function(){function e(e,n,t){return t.indexOf(e)===n}var n,t={prompt:"«≠"};return t.onOpen=function(t){t&&(Omnibar.input.value=t,Front.contentCommand({action:"omnibar_query_entered",query:t})),Front.contentCommand({action:"getPageText"},function(t){var r=/[^a-zA-Z]+/;n=t.data.toLowerCase().split(r).filter(e)})},t.onInput=function(){var e=Omnibar.input.value,t=n.filter(function(n){return n.indexOf(e)!==-1});t.length&&Omnibar.listResults(t,function(e){return createElement("<li>"+e+"</li>")})},t.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").innerText},t.onEnter=function(){Front.contentCommand({action:"omnibar_query_entered",query:Omnibar.input.value})},t}();Omnibar.addHandler("OmniQuery",OmniQuery);