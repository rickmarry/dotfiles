"use strict";function autocmd(e,n){var t,i="";"object"===("undefined"==typeof e?"undefined":_typeof(e))&&void 0!==e.test?(i=e.toString(),t=e):(i=e,t=new RegExp(e)),AutoCommands[i]={code:n,regex:t}}function createKeyTarget(e,n,t){var i={code:e};return t&&(i.repeatIgnore=t),n&&(n=_parseAnnotation(n),i.feature_group=n.feature_group,i.annotation=n.annotation),i}function _isDomainApplicable(e){return!e||e.test(document.location.href)||e.test(window.origin)}function _mapkey(e,n,t,i,o){if(o=o||{},_isDomainApplicable(o.domain)){n=KeyboardUtils.encodeKeystroke(n),e.mappings.remove(n);var a=createKeyTarget(i,{annotation:t,feature_group:e===Visual?9:14},o.repeatIgnore);e.mappings.add(n,a)}}function mapkey(e,n,t,i){_mapkey(Normal,e,n,t,i)}function vmapkey(e,n,t,i){_mapkey(Visual,e,n,t,i)}function imapkey(e,n,t,i){_mapkey(Insert,e,n,t,i)}function map(e,n,t,i){if(_isDomainApplicable(t))if(":"===n[0]){var o=n.substr(1),a=createKeyTarget(function(){Front.executeCommand(o)},i?_parseAnnotation({annotation:i}):null,!1);Normal.mappings.add(KeyboardUtils.encodeKeystroke(e),a)}else!_map(Normal,e,n)&&n in Mode.specialKeys&&Mode.specialKeys[n].push(e)}function unmap(e,n){if(_isDomainApplicable(n)){var t=Normal.mappings.find(KeyboardUtils.encodeKeystroke(e));if(t)Normal.mappings.remove(KeyboardUtils.encodeKeystroke(e));else for(var i in Mode.specialKeys){var o=Mode.specialKeys[i].indexOf(e);o!==-1&&Mode.specialKeys[i].splice(o,1)}}}function unmapAllExcept(e,n){if(_isDomainApplicable(n)){var t=[Normal,Insert];t.forEach(function(n){var t=new Trie;e=e||[];for(var i=0,o=e.length;i<o;i++){var a=KeyboardUtils.encodeKeystroke(e[i]),r=n.mappings.find(a);r&&t.add(a,r.meta)}delete n.mappings,n.mappings=t,n.map_node=t})}}function imap(e,n,t,i){_isDomainApplicable(t)&&_map(Insert,e,n)}function iunmap(e,n){_isDomainApplicable(n)&&Insert.mappings.remove(KeyboardUtils.encodeKeystroke(e))}function cmap(e,n,t,i){_isDomainApplicable(t)&&Front.addCMap(e,n)}function vmap(e,n,t,i){_isDomainApplicable(t)&&_map(Visual,e,n)}function vunmap(e,n){_isDomainApplicable(n)&&Visual.mappings.remove(KeyboardUtils.encodeKeystroke(e))}function aceVimMap(e,n,t){Front.addVimMap(e,n,t)}function addVimMapKey(){Front.addVimKeyMap(Array.from(arguments))}function addSearchAlias(e,n,t,i,o){Front.addSearchAlias(e,n,t,i,o)}function removeSearchAlias(e){Front.removeSearchAlias(e)}function addSearchAliasX(e,n,t,i,o,a,r){function s(){searchSelectedWith(t)}function c(){searchSelectedWith(t,!0)}addSearchAlias(e,n,t,o,a),mapkey((i||"s")+e,"#6Search selected with "+n,s),vmapkey((i||"s")+e,"",s),mapkey((i||"s")+(r||"o")+e,"",c),vmapkey((i||"s")+(r||"o")+e,"",c);var p=e.toUpperCase();if(p!==e){var l=function(){searchSelectedWith(t,!1,!0,e)},u=function(){searchSelectedWith(t,!0,!0,e)};mapkey((i||"s")+p,"",l),vmapkey((i||"s")+p,"",l),mapkey((i||"s")+(r||"o")+p,"",u),vmapkey((i||"s")+(r||"o")+p,"",u)}}function removeSearchAliasX(e,n,t){removeSearchAlias(e),unmap((n||"s")+e),vunmap((n||"s")+e),unmap((n||"s")+(t||"o")+e),vunmap((n||"s")+(t||"o")+e);var i=e.toUpperCase();i!==e&&(unmap((n||"s")+i),vunmap((n||"s")+i),unmap((n||"s")+(t||"o")+i),vunmap((n||"s")+(t||"o")+i))}function walkPageUrl(e){for(var n=0;n<runtime.conf.pageUrlRegex.length;n++){var t=window.location.href.match(runtime.conf.pageUrlRegex[n]);if(t&&4===t.length){var i=parseInt(t[2]);if(i<4294967295)return window.location.href=t[1]+(i+e)+t[3],!0}}return!1}function previousPage(){var e=getClickableElements("a, button",runtime.conf.prevLinkRegex);return e=filterOverlapElements(e),e.length?(clickOn(e),!0):walkPageUrl(-1)}function nextPage(){var e=getClickableElements("a, button",runtime.conf.nextLinkRegex);return e=filterOverlapElements(e),e.length?(clickOn(e),!0):walkPageUrl(1)}function searchSelectedWith(e,n,t,i){Clipboard.read(function(o){var a=window.getSelection().toString()||o.data;n&&(a="site:"+window.location.hostname+" "+a),t?Front.openOmnibar({type:"SearchEngine",extra:i,pref:a}):tabOpenLink(constructSearchURL(e,encodeURIComponent(a)))})}function clickOn(e,n){"string"==typeof e&&(e=getClickableElements(e)),e.length>1?n?e.forEach(function(e){Hints.dispatchMouseClick(e)}):Hints.create(e,Hints.dispatchMouseClick):1===e.length&&Hints.dispatchMouseClick(e[0])}function getFormData(e,n){var t=new FormData(e);if("json"===n){var i={};return t.forEach(function(e,n){if(i.hasOwnProperty(n)){var t=i[n];"Array"===t.constructor.name?t.push(e):(i[n]=[],i[n].push(t),i[n].push(e))}else i[n]=e}),i}return new URLSearchParams(t).toString()}function httpRequest(e,n){e.action="request",e.method="get",runtime.command(e,n)}function runScript(e){var n={settings:{},error:""};try{var t=new Function("settings",e);t(n.settings)}catch(i){n.error=i.toString()}return n}function applySettings(e){for(var n in e)runtime.conf.hasOwnProperty(n)&&(runtime.conf[n]=e[n]);if("findHistory"in e&&(runtime.conf.lastQuery=e.findHistory.length?e.findHistory[0]:""),"snippets"in e&&e.snippets&&!Front.isProvider()){var t=runScript(e.snippets);if(""!==t.error&&(window===top?Front.showPopup("Error found in settings: "+t.error):console.log("Error found in settings({0}): {1}".format(window.location.href,t.error))),!isEmptyObject(t.settings)){Front.applyUserSettings(JSON.parse(JSON.stringify(t.settings)));for(var n in t.settings)runtime.conf.hasOwnProperty(n)&&(runtime.conf[n]=t.settings[n],delete t.settings[n]);Object.keys(t.settings).length>0&&window===top&&runtime.command({action:"updateSettings",scope:"snippets",settings:t.settings})}}runtime.conf.showProxyInStatusBar&&"proxyMode"in e&&(["byhost","always"].indexOf(e.proxyMode)!==-1?Front.showStatus(3,"{0}: {1}".format(e.proxyMode,e.proxy)):Front.showStatus(3,e.proxyMode))}function _init(){runtime.command({action:"getSettings"},function(e){var n=e.settings;applySettings(n),Normal.enter(),runtime.command({action:"getDisabled",blacklistPattern:runtime.conf.blacklistPattern?runtime.conf.blacklistPattern.toJSON():""},function(e){e.disabled?Disabled.enter(0,!0):usePdfViewer(),window===top&&runtime.command({action:"setSurfingkeysIcon",status:e.disabled})}),document.dispatchEvent(new CustomEvent("surfingkeys:userSettingsLoaded",{detail:n}))})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},AutoCommands={};runtime.on("settingsUpdated",function(e){var n=e.settings;applySettings(n),(n.hasOwnProperty("blacklist")||runtime.conf.blacklistPattern)&&runtime.command({action:"getDisabled",blacklistPattern:runtime.conf.blacklistPattern?runtime.conf.blacklistPattern.toJSON():""},function(e){e.disabled?Disabled.enter(0,!0):Disabled.exit(),window===top&&runtime.command({action:"setSurfingkeysIcon",status:e.disabled})})}),document.addEventListener("surfingkeys:defaultSettingsLoaded",function(e){_init()});